{% extends "base.html" %}

{% block title %}Notification Viewer{% endblock %}

{% block content %}
<div class="min-h-screen flex items-center justify-center bg-background-light dark:bg-background-dark p-6">
  <div class="w-full max-w-3xl bg-white/95 dark:bg-slate-900/90 rounded-lg shadow-lg p-4">
    <h2 class="text-lg font-bold mb-3 text-slate-800 dark:text-white">WC2026-Notification Panel</h2>
    <div style="height:70vh;">
      {% if allow_js %}
      <iframe id="pushViewerFrame" sandbox="allow-scripts allow-same-origin allow-forms allow-popups" style="width:100%;height:100%;border:0;border-radius:6px;"></iframe>
      {% else %}
      <iframe id="pushViewerFrame" sandbox="allow-same-origin allow-forms allow-popups" style="width:100%;height:100%;border:0;border-radius:6px;"></iframe>
      {% endif %}
    </div>
    <script>
      (function(){
        try {
          // 'html' has been URL-decoded on the server. Use tojson to embed safely into JS.
          const userHtml = {{ html | tojson | safe }} || '';
          const allowJs = {{ allow_js | tojson }} || false;
          const iframe = document.getElementById('pushViewerFrame');
          if (iframe) {
            const doc = '<!doctype html><html><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"></head><body style="margin:0;">' + userHtml + '</body></html>';
            iframe.srcdoc = doc;
          }
        } catch (e) { console.error('push viewer render error', e); }
      })();
    </script>
    <div class="mt-3 text-right">
      <a href="/" class="text-sm text-primary">Return to app</a>
    </div>
  </div>
</div>
{% endblock %}
